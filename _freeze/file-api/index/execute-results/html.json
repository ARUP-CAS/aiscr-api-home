{
  "hash": "127003b610c0ea3d60d8830851d1b19b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"AMCR File API\"\nsubtitle: API serving files and file thumbnails\ndate: 2025-03-28\n---\n\n\n## Overview\n\n**AMCR File API** serves files and their thumbnails from the AMCR repository.\nFile URLs can be obtained from the [OAI-PMH API](/oai-pmh/index.qmd) response.\nThey are in the `soubor/url` element of the response, see example below.\n\n- Base URL for the file API is `https://digiarchiv.aiscr.cz/id/`.\n\n### Example response from OAI-PMH API\n\nNote that in the examples on this page files accessible to anyone on the internet are accessed, i.e. their `dokument/pristupnost` element equals value `A`.\n\n#### Samostatný nález / Individual find\n\nThis is part of the response of one of the records from `setSpec`: `samostatny_nalez`.\n\nRequest: <https://api.aiscr.cz/oai?verb=GetRecord&metadataPrefix=oai_amcr&identifier=https://api.aiscr.cz/id/M-202301215-N00001>\n\n```xml\n<amcr:soubor>\n\t<amcr:id>soub-565387</amcr:id>\n\t<amcr:path>rest/AMCR/record/M-202301215-N00001/file/aa0cdd95-4bc4-4358-a831-2cf8672a3e4b</amcr:path>\n\t<amcr:nazev>M202301215N00001F01.JPG</amcr:nazev>\n\t<amcr:mimetype>image/jpeg</amcr:mimetype>\n\t<amcr:rozsah>1</amcr:rozsah>\n\t<amcr:size_mb>0.4693031311</amcr:size_mb>\n\t<amcr:sha_512>[...]</amcr:sha_512>\n\t<amcr:url>https://digiarchiv.aiscr.cz/id/M-202301215-N00001/file/aa0cdd95-4bc4-4358-a831-2cf8672a3e4b</amcr:url>\n\t<amcr:historie>\n\t\t[...]\n\t</amcr:historie>\n</amcr:soubor> \n```\n\n#### Dokument / Document\n\nThis is part of the response of one of the records from `setSpec`: `dokument`.\n\nRequest: <https://api.aiscr.cz/oai?verb=GetRecord&metadataPrefix=oai_amcr&identifier=https://api.aiscr.cz/id/C-TX-198603094>\n\n```xml \n<amcr:soubor>\n\t<amcr:id>soub-121748</amcr:id>\n\t<amcr:path>rest/AMCR/record/C-TX-198603094/file/3e28c562-17f6-48dc-b8f5-787d14fb55af</amcr:path>\n\t<amcr:nazev>CTX198603094.pdf</amcr:nazev>\n\t<amcr:mimetype>application/pdf</amcr:mimetype>\n\t<amcr:rozsah>2</amcr:rozsah>\n\t<amcr:size_mb>0.5069980621</amcr:size_mb>\n\t<amcr:sha_512>[...]</amcr:sha_512>\n\t<amcr:url>https://digiarchiv.aiscr.cz/id/C-TX-198603094/file/3e28c562-17f6-48dc-b8f5-787d14fb55af</amcr:url>\n\t<amcr:historie>\n\t\t[...]\n\t</amcr:historie>\n</amcr:soubor> \n```\n\n#### Schema explanation\n\nBelow is an explanation of the schema with examples.\nNote that namespace prefix `amcr:` is stripped from the element tags.\n\n| Element tag | Description | Example |\n|-------------|-------------|---------|\n| `<id>` | File ID | `soub-565387` |\n| `<path>` | Path to the file | `rest/AMCR/record/M-202301215-N00001/file/aa0cdd95-4bc4-4358-a831-2cf8672a3e4b` |\n| `<nazev>` | Filename | `M202301215N00001F01.JPG` |\n| `<mimetype>` | Mimetype | `image/jpeg` |\n| `<rozsah>` | Page count | `1` |\n| `<size_mb>` | Size in MB | `0.4693031311` |\n| `<sha_512>` | SHA-512 checksum | `53aaf...` |\n| `<url>` | URL to the file | `https://digiarchiv.aiscr.cz/id/M-202301215-N00001/file/aa0cdd95-4bc4-4358-a831-2cf8672a3e4b` |\n| `<historie>` | Element with a record of changes | *individual subelements* |\n\n### Access rules\n\nDifferent access rules apply to different files and access groups.\nThere are three main groups of users:\n\n- **A** (*Anonym*/*Anonymous*) -- anyone in the internet, non authenticated user;\n- **B** (*Badatel*/*Researcher*) -- any user registered in the system;\n- **C** (*Archeolog*/*Archaeologist*) -- archaeologist from a licensed organisation.\n\nFurthermore, groups **D** (*Archivář*/*Archivist*) and **E** (*Administrátor*/*Admin*) exist and no restrictions apply to them.\n\n::: {.column-page-inset-right}\n\n::: {.cell tbl-cap='Basic rules for file access'}\n::: {.cell-output-display}\n\n\n|XPath                       |A                                   |B                                                   |C                                                                                 |\n|:---------------------------|:-----------------------------------|:---------------------------------------------------|:---------------------------------------------------------------------------------|\n|`//projekt/soubor`          |&#x2718;                            |&#x2718;                                            |`stav` = 1<br>OR (`stav` >= 2 AND `stav` <= 6<br>AND my organisation record)      |\n|`//dokument/soubor`         |`pristupnost` = A<br>AND `stav` = 3 |(`pristupnost` <= B AND `stav` = 3)<br>OR my record |(`pristupnost` <= C AND `stav` = 3)<br>OR my organisation record                  |\n|`//samostatny_nalez/soubor` |`pristupnost` = A<br>AND `stav` = 4 |(`pristupnost` <= C AND `stav` = 4)<br>OR my record |(`pristupnost` <= B AND `stav` = 4)<br>OR my record <br>OR my organisation record |\n\n\n:::\n:::\n\n:::\n\n### Authentication\n\n#### Basic authentication\n\nOnly basic access authentication using AMCR credentials (username and password) is supported.\n\n::: {.callout-tip}\nUser registration is available here: [https://amcr.aiscr.cz/accounts/register/](https://amcr.aiscr.cz/accounts/register/){.external}. \n:::\n\n##### cURL example\n\n```sh \ncurl -u <username> \"https://digiarchiv.aiscr.cz/id/M-202301215-N00001/file/aa0cdd95-4bc4-4358-a831-2cf8672a3e4b/thumb\" \\\n    -o thumbnail.jpg\n```\n\n#### Authentication API \n\n- Authentication using bearer token returned by the AMCR Authentication API is **not** (yet) supported.\n\n### Variables \n\n| Name | Type | Description | Required | Example |\n|------|------|-------------|----------|---------|\n| `digiarchiv_url` | *string* | Base URL for the API | `true` | `https://digiarchiv.aiscr.cz/` |\n| `ident_cely` | *string* | Full identifier of the record | `true` | `M-202301215-N00001`, `C-TX-198603094` |\n| `file_id` | *string* | Unique identifier of the file | `true` | `aa0cdd95-4bc4-4358-a831-2cf8672a3e4b`, `3e28c562-17f6-48dc-b8f5-787d14fb55af` |\n| `page` | *integer* | Specific page number | `true` for large thumbnails endpoint | `1`, `2` |\n\n\n## Endpoints \n\n### Small thumbnails\n\n`GET` method for thumbnails of images and documents. \nIn case of multipage documents (i.e. value of `<rozsah>` tag > 1), this method returns its first page.\nThumbnails are in **JPEG** file format, with the maximum **size of 100x100 px**.\nAll small thumbnails are available without authentication.\n\n- Method: `GET`\n- Endpoint: `/id/{ident_cely}/file/{file_id}/thumb`\n\n#### Example requests\n\n##### cURL\n\n```sh \ncurl \"https://digiarchiv.aiscr.cz/id/M-202301215-N00001/file/aa0cdd95-4bc4-4358-a831-2cf8672a3e4b/thumb\" \\\n    -o thumbnail.jpeg\n```\n\n##### BASH script \n\nPrompts for username and password.\n\n```{.bash filename=\"thumb.sh\"} \n#!/bin/bash\n\n# Prompt for username\nread -p \"Enter username: \" username\n\n# Prompt for password securely\nread -sp \"Enter password: \" password\necho \n\n# Curl command with authentication and output\ncurl -u \"$username:$password\" \\\n    \"https://digiarchiv.aiscr.cz/id/M-202301215-N00001/file/aa0cdd95-4bc4-4358-a831-2cf8672a3e4b/thumb\" \\\n    -o thumbnail.jpeg\n```\n\n##### Python script\n\nPrompts for username and password and checks status code of the response.\n\n```{.python filename=\"thumb.py\"}\n#!/usr/bin/env python \n\nimport requests\nimport getpass\n\n# Base URL\nbase_url = \"https://digiarchiv.aiscr.cz\"\n\n# File download parameters\nident_cely = \"M-202301215-N00001\"\nfile_id = \"aa0cdd95-4bc4-4358-a831-2cf8672a3e4b\"\n\n# Download thumbnail\nresponse = requests.get(\n    f\"{base_url}/id/{ident_cely}/file/{file_id}/thumb\",\n)\n\n# Save file if file download was successful\nif response.status_code == 200:\n    # Save the file\n    with open(f\"{file_id}.jpeg\", \"wb\") as file:\n        file.write(response.content)\n    print(\"Thumbnail downloaded successfully.\")\nelse:\n    print(f\"Failed to download thumbnail. Status code: {response.status_code}\")\n    print(f\"Response: {response.text}\")\n\n```\n\n\n### Large thumbnails\n\n`GET` method to request large thumbnail of any page in the document.\nLarge thumbnails are in **JPEG** file format, with the maximum **size of 800x800 px**.\nWithout authentication, only some of the large thumbnails are available, see section [Authentication](index.qmd#authentication) above.\n\n- Method: `GET`\n- Endpoint: `/id/{ident_cely}/file/{file_id}/thumb/page/{page}`\n\n#### Example requests\n\n##### cURL \n\n```sh \ncurl \"https://digiarchiv.aiscr.cz/id/C-TX-198603094/file/3e28c562-17f6-48dc-b8f5-787d14fb55af/thumb/page/2\" \\\n    -o thumbnail.jpeg\n```\n\n\n### Original files\n\n`GET` method to request original files.\nWithout authentication, only some original files are available, see section [Authentication](index.qmd#authentication) above.\n\n- Method: `GET`\n- Endpoint: `/id/{ident_cely}/file/{file_id}`\n\n\n#### Example requests \n\n##### cURL \n\n```sh \ncurl \"https://digiarchiv.aiscr.cz/id/M-202301215-N00001/file/aa0cdd95-4bc4-4358-a831-2cf8672a3e4b\" \\\n    -o file.jpeg\n```\n\n## Notes\n\n### Error Handling\n\n#### Common Error Codes\n\n| Code | Description | Possible Cause |\n|------|-------------|----------------|\n| 401 | Unauthorized | Invalid credentials |\n| 403 | Forbidden | Insufficient permissions |\n| 404 | Not Found | Invalid identifier or file ID |\n| 429 | Too many requests | Too frequent requests (parallelisation not allowed, 1s or more between requests)\n\n\n## Postman definition\n\n```{.json filename=\"amcr_file_postman.json\"}\n{\n\t\"info\": {\n\t\t\"_postman_id\": \"6904ca89-9b29-4afd-8770-37627755da67\",\n\t\t\"name\": \"AMCR - files\",\n\t\t\"schema\": \"https://schema.getpostman.com/json/collection/v2.1.0/collection.json\",\n\t\t\"_exporter_id\": \"27641694\"\n\t},\n\t\"item\": [\n\t\t{\n\t\t\t\"name\": \"Download thumbnail\",\n\t\t\t\"protocolProfileBehavior\": {\n\t\t\t\t\"disableCookies\": true\n\t\t\t},\n\t\t\t\"request\": {\n\t\t\t\t\"method\": \"GET\",\n\t\t\t\t\"header\": [],\n\t\t\t\t\"url\": {\n\t\t\t\t\t\"raw\": \"{{digiarchiv_url}}/id/{{ident_cely}}/file/{{file_id}}/thumb\",\n\t\t\t\t\t\"host\": [\n\t\t\t\t\t\t\"{{digiarchiv_url}}\"\n\t\t\t\t\t],\n\t\t\t\t\t\"path\": [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"{{ident_cely}}\",\n\t\t\t\t\t\t\"file\",\n\t\t\t\t\t\t\"{{file_id}}\",\n\t\t\t\t\t\t\"thumb\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"response\": []\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Download page thumbnail\",\n\t\t\t\"protocolProfileBehavior\": {\n\t\t\t\t\"disableCookies\": true\n\t\t\t},\n\t\t\t\"request\": {\n\t\t\t\t\"method\": \"GET\",\n\t\t\t\t\"header\": [],\n\t\t\t\t\"url\": {\n\t\t\t\t\t\"raw\": \"{{digiarchiv_url}}/id/{{ident_cely}}/file/{{file_id}}/thumb/page/{{page}}\",\n\t\t\t\t\t\"host\": [\n\t\t\t\t\t\t\"{{digiarchiv_url}}\"\n\t\t\t\t\t],\n\t\t\t\t\t\"path\": [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"{{ident_cely}}\",\n\t\t\t\t\t\t\"file\",\n\t\t\t\t\t\t\"{{file_id}}\",\n\t\t\t\t\t\t\"thumb\",\n\t\t\t\t\t\t\"page\",\n\t\t\t\t\t\t\"{{page}}\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"response\": []\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Download original\",\n\t\t\t\"protocolProfileBehavior\": {\n\t\t\t\t\"disableCookies\": true\n\t\t\t},\n\t\t\t\"request\": {\n\t\t\t\t\"method\": \"GET\",\n\t\t\t\t\"header\": [],\n\t\t\t\t\"url\": {\n\t\t\t\t\t\"raw\": \"{{digiarchiv_url}}/id/{{ident_cely}}/file/{{file_id}}\",\n\t\t\t\t\t\"host\": [\n\t\t\t\t\t\t\"{{digiarchiv_url}}\"\n\t\t\t\t\t],\n\t\t\t\t\t\"path\": [\n\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\"{{ident_cely}}\",\n\t\t\t\t\t\t\"file\",\n\t\t\t\t\t\t\"{{file_id}}\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"response\": []\n\t\t}\n\t],\n\t\"auth\": {\n\t\t\"type\": \"basic\",\n\t\t\"basic\": [\n\t\t\t{\n\t\t\t\t\"key\": \"password\",\n\t\t\t\t\"value\": \"{{amcr_password}}\",\n\t\t\t\t\"type\": \"string\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"key\": \"username\",\n\t\t\t\t\"value\": \"{{amcr_user}}\",\n\t\t\t\t\"type\": \"string\"\n\t\t\t}\n\t\t]\n\t},\n\t\"event\": [\n\t\t{\n\t\t\t\"listen\": \"prerequest\",\n\t\t\t\"script\": {\n\t\t\t\t\"type\": \"text/javascript\",\n\t\t\t\t\"packages\": {},\n\t\t\t\t\"exec\": [\n\t\t\t\t\t\"\"\n\t\t\t\t]\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"listen\": \"test\",\n\t\t\t\"script\": {\n\t\t\t\t\"type\": \"text/javascript\",\n\t\t\t\t\"packages\": {},\n\t\t\t\t\"exec\": [\n\t\t\t\t\t\"\"\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t],\n\t\"variable\": [\n\t\t{\n\t\t\t\"key\": \"ident_cely\",\n\t\t\t\"value\": \"\",\n\t\t\t\"type\": \"default\"\n\t\t},\n\t\t{\n\t\t\t\"key\": \"file_id\",\n\t\t\t\"value\": \"\",\n\t\t\t\"type\": \"default\"\n\t\t},\n\t\t{\n\t\t\t\"key\": \"page\",\n\t\t\t\"value\": \"1\"\n\t\t}\n\t]\n}\n```\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}